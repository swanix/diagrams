<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="robots" content="noindex, nofollow">
  <title>Swanix Diagrams - Demo D3 Zoom</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- Favicon -->
  <link rel="shortcut icon" href="assets/images/favicon.ico">
  <!-- Scripts -->
  <script src="https://d3js.org/d3.v3.min.js"></script>
 <!-- Styles -->
 <style>
  html, body {
    width: 100%;
    height: 100%;
    padding: 0;
    margin: 0;
    background: #FFFFFF;
  }
  
  .overlay {
    fill: none;
    pointer-events: all;
  }
  
  #viewer {
    width: 100vw;
    height: 100vh;
    position: relative;
    background: #F6F7F9;
  }
  
  svg {
    font: 10px sans-serif;
    shape-rendering: crispEdges;
  }
  
  
  button {
    padding: 6px 8px;
    border-radius: 6px;
    background: #FFF;
    border: 2px solid #EDEDED;
    outline: none;
    cursor: pointer;
  }
  
  button:hover {
    background: #FAFAFA;
  }
  
  #reset-zoom {
    position: absolute;
    top: 0;
    right: 0;
    margin: 8px;
  }
  </style>
</head>
<body>

<!-- Based on https://stackoverflow.com/questions/36721415/d3js-zoom-svg-and-axix?rq=1 
     http://jsfiddle.net/lulylulu/84d0L6v4/ -->

<div id="viewer">
    <button id="reset-zoom">Reset Zoom</button>
</div>

<script>
'use strict';

var diagram = {
  name: "base",
  x: 0,
  y: -900,
  width: 980,
  url: 'https://swanix.org/diagrams/src/draw-io/org-chart.svg'
}

var margin = {
  top: 20,
  right: 20,
  bottom: 30,
  left: 40
};

var width = '100vw',
  height = '100vh';

var x = d3.scale.linear()
  .domain([0, width])
  .range([0, width]);

var y = d3.scale.linear()
  .domain([0, height])
  .range([height, 0]);

var xAxis = d3.svg.axis()
  .scale(x)
  .orient("bottom")
  .tickSize(-height);

var yAxis = d3.svg.axis()
  .scale(y)
  .orient("left")
  .ticks(5)
  .tickSize(-width);

var zoom = d3.behavior.zoom()
  .x(x)
  .y(y)
  .scaleExtent([1, 32])
  .on("zoom", zoomed);

var svg = d3.select('#viewer').append('svg')
  .attr("width", width + margin.right + margin.left)
  .attr("height", height + margin.top + margin.bottom)
  .call(zoom);

// svg.append("rect")
//    .attr("width", "100%")
//    .attr("height", "100%")
//    .attr("fill", "royalblue");

d3.select("#reset-zoom").on("click", reset);

var elementsToScale = svg.append("g")
  .attr("id", "elementsToScale")

function zoomed() {
  svg.select(".x.axis").call(xAxis);
  svg.select(".y.axis").call(yAxis);
  var translate = d3.event ? d3.event.translate : '0,0'
  var scale = d3.event ? d3.event.scale : '1'
  svg.select('#elementsToScale').attr("transform", "translate(" + translate + ")" + " scale(" + scale + ")");
}

function reset() {
  d3.transition().duration(750).tween("zoom", function() {
    var ix = d3.interpolate(x.domain(), [0, width]),
      iy = d3.interpolate(y.domain(), [0, height]);
    return function(t) {
      zoom.x(x.domain(ix(t))).y(y.domain(iy(t)));
      zoomed();
    };
  });
}

function showDiagram(el, offsetX = 0, offsetY = 0) {
  d3.xml(el.url, 'image/svg+xml', function(error, xml) {
    if (error) {
      console.log('error' + error)
      throw error;
    }
    var svgNode = xml.getElementsByTagName('svg')[0];
    d3.select(svgNode).attr('id', diagram.name)
      .attr('x', el.x + offsetX)
      .attr('y', el.y + offsetY);
    elementsToScale.node().appendChild(svgNode);
    elementsToScale.select('#' + el.name)
      .attr('width', el.width);
  });
}

showDiagram(diagram, 50);

</script>

</body>
</html>