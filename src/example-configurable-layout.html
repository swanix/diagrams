<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ejemplo: Layout Configurable de Clusters</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .title {
            color: #333;
            border-bottom: 2px solid #007acc;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .description {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #007acc;
        }
        .config-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .config-section h3 {
            margin-top: 0;
            color: #333;
        }
        .config-item {
            margin-bottom: 10px;
        }
        .config-item label {
            display: inline-block;
            width: 150px;
            font-weight: bold;
        }
        .config-item input {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            width: 80px;
        }
        .config-item .description {
            font-size: 12px;
            color: #666;
            margin-left: 150px;
            margin-top: 2px;
        }
        .example-code {
            background: #f1f1f1;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            margin: 10px 0;
            border-left: 4px solid #007acc;
        }
        .current-config {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #28a745;
            margin-bottom: 20px;
        }
        .current-config h4 {
            margin-top: 0;
            color: #28a745;
        }
        #diagram-container {
            width: 100%;
            height: 600px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: white;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">Ejemplo: Layout Configurable de Clusters</h1>
        
        <div class="description">
            <strong>Objetivo:</strong> Mostrar cómo configurar el número de clusters por fila y otros parámetros de layout desde el archivo HTML.
            <br><br>
            <strong>Beneficios:</strong>
            <ul>
                <li>Configuración flexible sin modificar código JavaScript</li>
                <li>Ajuste del número de clusters por fila según necesidades</li>
                <li>Personalización de márgenes y espaciados</li>
                <li>Configuración por diagrama o global</li>
            </ul>
        </div>
        
        <div class="current-config">
            <h4>Configuración Actual</h4>
            <div id="currentConfigDisplay">
                Cargando configuración...
            </div>
        </div>
        
        <div class="config-section">
            <h3>Configuración de Layout</h3>
            <p>Puedes configurar estos parámetros en el objeto <code>options.layout</code>:</p>
            
            <div class="config-item">
                <label>clustersPerRow:</label>
                <input type="number" id="clustersPerRow" value="7" min="1" max="20">
                <div class="description">Número de clusters por fila (por defecto: 7)</div>
            </div>
            
            <div class="config-item">
                <label>marginX:</label>
                <input type="number" id="marginX" value="50" min="0" max="200">
                <div class="description">Margen izquierdo en píxeles (por defecto: 50)</div>
            </div>
            
            <div class="config-item">
                <label>marginY:</label>
                <input type="number" id="marginY" value="50" min="0" max="200">
                <div class="description">Margen superior en píxeles (por defecto: 50)</div>
            </div>
            
            <div class="config-item">
                <label>spacingX:</label>
                <input type="number" id="spacingX" value="60" min="0" max="200">
                <div class="description">Espacio horizontal entre clusters (por defecto: 60)</div>
            </div>
            
            <div class="config-item">
                <label>spacingY:</label>
                <input type="number" id="spacingY" value="60" min="0" max="200">
                <div class="description">Espacio vertical entre filas (por defecto: 60)</div>
            </div>
        </div>
        
        <div class="config-section">
            <h3>Ejemplos de Configuración</h3>
            
            <h4>1. Configuración Global (para todos los diagramas)</h4>
            <div class="example-code">
// En el script de configuración
window.$xDiagrams = {
  options: {
    layout: {
      clustersPerRow: 5,    // 5 clusters por fila
      marginX: 30,          // 30px margen izquierdo
      marginY: 40,          // 40px margen superior
      spacingX: 50,         // 50px gap horizontal
      spacingY: 70          // 70px gap vertical
    }
  },
  diagrams: [
    // ... tus diagramas aquí
  ]
};
            </div>
            
            <h4>2. Configuración por Diagrama</h4>
            <div class="example-code">
// Configuración específica para un diagrama
const diagramConfig = {
  name: "Mi Diagrama",
  data: [...],
  options: {
    layout: {
      clustersPerRow: 3,    // Solo 3 clusters por fila para este diagrama
      marginX: 100,         // Margen más grande
      spacingX: 80          // Gap más grande
    }
  }
};
            </div>
            
            <h4>3. Configuración Responsive</h4>
            <div class="example-code">
// Configuración que se adapta al tamaño de pantalla
window.$xDiagrams = {
  options: {
    layout: {
      clustersPerRow: window.innerWidth < 768 ? 3 : 7,  // 3 en móvil, 7 en desktop
      marginX: window.innerWidth < 768 ? 20 : 50,       // Márgenes más pequeños en móvil
      spacingX: window.innerWidth < 768 ? 30 : 60       // Gaps más pequeños en móvil
    }
  }
};
            </div>
        </div>
        
        <div class="config-section">
            <h3>Datos de Prueba</h3>
            <p>Este ejemplo usa datos de prueba con 12 clusters para demostrar el layout configurable:</p>
            <div class="example-code">
// Datos de prueba con 12 clusters
const testData = [
  { id: 'A1', name: 'Cluster A1', parent: '', type: 'cluster' },
  { id: 'A2', name: 'Cluster A2', parent: '', type: 'cluster' },
  { id: 'A3', name: 'Cluster A3', parent: '', type: 'cluster' },
  { id: 'B1', name: 'Cluster B1', parent: '', type: 'cluster' },
  { id: 'B2', name: 'Cluster B2', parent: '', type: 'cluster' },
  { id: 'B3', name: 'Cluster B3', parent: '', type: 'cluster' },
  { id: 'C1', name: 'Cluster C1', parent: '', type: 'cluster' },
  { id: 'C2', name: 'Cluster C2', parent: '', type: 'cluster' },
  { id: 'C3', name: 'Cluster C3', parent: '', type: 'cluster' },
  { id: 'D1', name: 'Cluster D1', parent: '', type: 'cluster' },
  { id: 'D2', name: 'Cluster D2', parent: '', type: 'cluster' },
  { id: 'D3', name: 'Cluster D3', parent: '', type: 'cluster' }
];
            </div>
        </div>
    </div>
    
    <div id="diagram-container">
        <!-- El diagrama se cargará aquí -->
    </div>

    <!-- Scripts necesarios -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="xdiagrams.js"></script>
    
    <script>
        // Función para actualizar la configuración
        function updateLayoutConfig() {
            const clustersPerRow = parseInt(document.getElementById('clustersPerRow').value);
            const marginX = parseInt(document.getElementById('marginX').value);
            const marginY = parseInt(document.getElementById('marginY').value);
            const spacingX = parseInt(document.getElementById('spacingX').value);
            const spacingY = parseInt(document.getElementById('spacingY').value);
            
            // Actualizar la configuración global
            if (!window.$xDiagrams) {
                window.$xDiagrams = {};
            }
            if (!window.$xDiagrams.options) {
                window.$xDiagrams.options = {};
            }
            
            window.$xDiagrams.options.layout = {
                clustersPerRow: clustersPerRow,
                marginX: marginX,
                marginY: marginY,
                spacingX: spacingX,
                spacingY: spacingY
            };
            
            // Mostrar configuración actual
            updateConfigDisplay();
            
            // Recargar el diagrama con la nueva configuración
            loadTestDiagram();
        }
        
        // Función para mostrar la configuración actual
        function updateConfigDisplay() {
            const config = window.$xDiagrams?.options?.layout || {};
            const display = document.getElementById('currentConfigDisplay');
            
            display.innerHTML = `
                <strong>clustersPerRow:</strong> ${config.clustersPerRow || 7}<br>
                <strong>marginX:</strong> ${config.marginX || 50}px<br>
                <strong>marginY:</strong> ${config.marginY || 50}px<br>
                <strong>spacingX:</strong> ${config.spacingX || 60}px<br>
                <strong>spacingY:</strong> ${config.spacingY || 60}px
            `;
        }
        
        // Función para generar datos de prueba
        function generateTestData() {
            const data = [];
            const clusterCount = 12;
            
            for (let i = 0; i < clusterCount; i++) {
                const row = Math.floor(i / 3) + 1;
                const col = (i % 3) + 1;
                const clusterId = String.fromCharCode(65 + row - 1) + col;
                
                // Cluster principal
                data.push({
                    id: clusterId,
                    name: `Cluster ${clusterId}`,
                    parent: '',
                    description: `Descripción del cluster ${clusterId}`,
                    image: '',
                    url: '',
                    type: 'cluster'
                });
                
                // Agregar algunos nodos hijos para cada cluster
                const nodeCount = Math.floor(Math.random() * 3) + 2; // 2-4 nodos
                for (let j = 1; j <= nodeCount; j++) {
                    data.push({
                        id: `${clusterId}-${j}`,
                        name: `Nodo ${j}`,
                        parent: clusterId,
                        description: `Nodo ${j} del cluster ${clusterId}`,
                        image: '',
                        url: '',
                        type: 'node'
                    });
                }
            }
            
            return data;
        }
        
        // Función para cargar el diagrama de prueba
        function loadTestDiagram() {
            const testData = generateTestData();
            
            const diagramConfig = {
                name: 'Test-Configurable-Layout',
                data: testData,
                isLocal: true
            };
            
            if (window.loadFromObject) {
                window.loadFromObject(diagramConfig, function(success) {
                    if (success) {
                        console.log('✅ Diagrama cargado con configuración actualizada');
                    } else {
                        console.error('❌ Error al cargar el diagrama');
                    }
                });
            }
        }
        
        // Configurar event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar event listeners para los inputs
            document.getElementById('clustersPerRow').addEventListener('change', updateLayoutConfig);
            document.getElementById('marginX').addEventListener('change', updateLayoutConfig);
            document.getElementById('marginY').addEventListener('change', updateLayoutConfig);
            document.getElementById('spacingX').addEventListener('change', updateLayoutConfig);
            document.getElementById('spacingY').addEventListener('change', updateLayoutConfig);
            
            // Configuración inicial
            window.$xDiagrams = {
                options: {
                    layout: {
                        clustersPerRow: 7,
                        marginX: 50,
                        marginY: 50,
                        spacingX: 60,
                        spacingY: 60
                    }
                }
            };
            
            // Mostrar configuración inicial
            updateConfigDisplay();
            
            // Cargar diagrama inicial
            loadTestDiagram();
        });
    </script>
</body>
</html> 