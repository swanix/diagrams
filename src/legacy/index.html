<!DOCTYPE html>
<html lang="en" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="google" content="notranslate">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swanix Diagrams</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="sw-diagrams.js"></script>
    <link href="sw-diagrams.css" rel="stylesheet">
    <link rel="icon" href="https://swanix.org/assets/images/favicon.ico" type="image/x-icon">
    
    <style>
        /* Estilos para el contenedor encapsulado */
        .swanix-diagram-container {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-color);
            background-image: var(--bg-image);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            color: var(--text-color);
            position: relative;
            height: 100vh;
            width: 100%;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }
        
        /* Overlay para controlar la opacidad del color de fondo */
        .swanix-diagram-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-color);
            opacity: var(--bg-opacity);
            z-index: -2;
            pointer-events: none;
        }
        
        /* Variables CSS por defecto */
        .swanix-diagram-container {
            --bg-color: #ecf2fd;
            --text-color: #222;
            --node-fill: #fff;
            --label-border: #bdbdbd;
            --node-selection-focus: #1976d2;
            --link-color: #999;
            --image-filter: grayscale(30%);
            --bg-image: url("img/backgrounds/light-pattern.svg");
            --bg-opacity: 0.9;
            --topbar-bg: #ffffff;
            --topbar-text: #333333;
            --sidepanel-bg: #ffffff;
            --sidepanel-text: #333333;
            --sidepanel-border: #dddddd;
            --control-bg: #ffffff;
            --control-text: #333333;
            --control-border: #d1d5db;
            --control-border-hover: #9ca3af;
            --control-border-focus: #1976d2;
            --control-placeholder: #9ca3af;
            --control-shadow: rgba(0, 0, 0, 0.1);
            --control-shadow-focus: rgba(25, 118, 210, 0.2);
        }
        
        /* Asegurar que el contenedor tenga las mismas propiedades que el body */
        .swanix-diagram-container,
        .swanix-diagram-container * {
            box-sizing: border-box;
        }
        
        /* Ajustar el SVG para que funcione dentro del contenedor */
        .swanix-diagram-container svg {
            width: 100%;
            height: calc(100vh - 60px); /* Restar altura del topbar */
            display: block;
        }
        
        /* Ajustar el topbar para que funcione dentro del contenedor */
        .swanix-diagram-container .topbar {
            position: relative;
            width: 100%;
            z-index: 10;
            margin: 0;
            padding: 0 20px;
        }
        
        /* Ajustar el loading para que funcione dentro del contenedor */
        .swanix-diagram-container #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 5;
        }
        
        /* Ajustar el error message para que funcione dentro del contenedor */
        .swanix-diagram-container .error-message {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 5;
        }
        
        /* Ajustar el side panel para que funcione dentro del contenedor */
        .swanix-diagram-container .side-panel {
            position: absolute;
            top: 60px; /* Posicionar debajo del topbar */
            right: -400px; /* Oculto por defecto */
            height: calc(100vh - 60px); /* Altura total menos el topbar */
            z-index: 20;
            transition: right 0.3s ease-in-out;
        }
        
        .swanix-diagram-container .side-panel.open {
            right: 0;
        }
        
        /* Ajustar el side panel overlay para que funcione dentro del contenedor */
        .swanix-diagram-container .side-panel-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 15;
        }
    </style>
</head>
<body>
    <!-- Contenedor encapsulado del diagrama -->
    <div id="swanix-diagram" class="swanix-diagram-container">
        <!-- Topbar moderno -->
        <div class="topbar">
            <div class="topbar-left">
                <div class="controls-container">
                    <select id="type-dropdown" class="control-item">
                        <!-- Se llena dinámicamente -->
                    </select>
                    <input type="text" id="search-input" class="control-item" placeholder="Buscar nodo...">
                </div>
            </div>
            
            <div class="topbar-center">
                <h1 class="diagram-title">Swanix Diagrams</h1>
            </div>
            
            <div class="topbar-right">
                <select id="theme-selector" class="theme-selector">
                                                <option value="snow">Snow</option>
                            <option value="onyx">Onyx</option>
                            <option value="vintage">Vintage</option>
                            <option value="pastel">Pastel</option>
                            <option value="neon">Neon</option>
                </select>
            </div>
        </div>

        <svg></svg>
        <div id="loading" class="loading">
            <div class="spinner"></div>
        </div>
        <small id="error-message" class="error-message"></small>
    </div>

    <script>
        // Inicializar el diagrama cuando se carga la página
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar el diagrama directamente
            initDiagram("https://docs.google.com/spreadsheets/d/e/2PACX-1vTQZfZhC3cWHg0QkqRoY9i3alinAnSHab5DJtWzsm_xAhLKKJdHri8fBMUawh-DhpvCkm-G1vBeWPFq/pub?gid=466976322&single=true&output=csv");
        });
    </script>
</body>
</html>